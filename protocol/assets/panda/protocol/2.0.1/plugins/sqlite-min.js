/*! protocol - v2.0.1 - 2015-07-13 */function SQLite(cfg){function isNumber(a){switch(typeof a){case"number":return!0;case"string":return!1;case"object":return!1}}function nullDataHandler(a){}function errorHandler(a){logger.error("Oops. "+a.message+" (Code "+a.code+")")}function execute(query,values,dataHandler){if(!query)return null;query=query.split("?");for(var newQuery=query[0],index=0,idx=0;idx<values.length;idx++){var value=values[idx]||"";!isNumber(value)&&value.indexOf("desc")<0&&value.indexOf("asc")&&(value=(value||"").replace(/\'/g,"''").replace(/\"/g,'\\"'),value="'"+value+"'"),newQuery+=value,newQuery+=index+1<query.length?query[index+1]:"",index++}var dHandler=function(rownum,data){try{data=eval("("+data+")")}catch(e){}dataHandler(rownum,data)};return logger.log("SQLITE执行sql语句:"+newQuery),sqlite.execSql(newQuery,dHandler)}function buildConditions(a){var b,c=[],d=[];if("string"==typeof a)c.push(a);else if("number"==typeof a)c.push("id=?"),d.push(a);else if("object"==typeof a)for(b in a)a.hasOwnProperty(b)&&(isNumber(b)?c.push(a[b]):(c.push(b+"=?"),d.push(a[b])));return c=c.length>0?" WHERE "+c.join(" AND "):"",[c,d]}function createIndexSQL(a,b,c){var d="CREATE INDEX IF NOT EXISTS "+a+" ON "+b+"("+c+");";return[d,[]]}function createTableSQL(a,b){var c="CREATE TABLE IF NOT EXISTS "+a+"("+b+");";return[c,[]]}function dropTableSQL(a){var b="DROP TABLE "+a+";";return[b,[]]}function insertSQL(a,b){var c,d="INSERT INTO "+a+" (#k#) VALUES(#v#);",e=[],f=[],g=[];for(c in b)b.hasOwnProperty(c)&&(e.push(c),f.push("?"),g.push(b[c]));return d=d.replace("#k#",e.join(",")),d=d.replace("#v#",f.join(",")),[d,g]}function replaceSQL(a,b){var c,d="REPLACE INTO "+a+" (#k#) VALUES(#v#);",e=[],f=[],g=[];for(c in b)b.hasOwnProperty(c)&&(e.push(c),f.push("?"),g.push(b[c]));return d=d.replace("#k#",e.join(",")),d=d.replace("#v#",f.join(",")),[d,g]}function updateSQL(a,b,c){var d,e="UPDATE "+a+" SET #k##m#",f=[],g=[];for(d in b)b.hasOwnProperty(d)&&(f.push(d+"=?"),g.push(b[d]));return c=buildConditions(c),g=g.concat(c[1]),e=e.replace("#k#",f.join(",")),e=e.replace("#m#",c[0]),[e,g]}function selectSQL(a,b,c,d){var e="SELECT #col# FROM "+a+"#cond#",f=[];return"undefined"==typeof b?b="*":"object"==typeof b&&b.join(","),c=buildConditions(c),f=f.concat(c[1]),e=e.replace("#col#",b),e=e.replace("#cond#",c[0]),d&&(d.order&&(e+=" ORDER BY ?",f.push(d.order)),d.limit&&(e+=" LIMIT ?",f.push(d.limit)),d.offset&&(e+=" OFFSET ?",f.push(d.offset))),e+=";",[e,f]}function destroySQL(a,b){var c="DELETE FROM "+a+"#c#;";return b=buildConditions(b),c=c.replace("#c#",b[0]),[c,b[1]]}var sqlite=external.createObject("Sqlite");if(null!=sqlite){var config=cfg||{},db;config.shortName=config.shortName||"mydatabase",config.version=config.version||"1.0",config.displayName=config.displayName||"My SQLite Database",config.maxSize=65536,config.defaultErrorHandler=config.defaultErrorHandler||errorHandler,config.defaultDataHandler=config.defaultDataHandler||nullDataHandler;var result=sqlite.createDataBase(config.path);return"-2"==result?void logger.error("打开数据库失败，参数错误。"):"-3"==result?void logger.error("打开数据库失败."):{database:sqlite,createIndex:function(a,b,c,d,e){var f=createIndexSQL(a,b,c);return execute(f[0],f[1],d,e)},createTable:function(a,b,c,d){var e=createTableSQL(a,b);return execute(e[0],e[1],c,d)},dropTable:function(a,b,c){var d=dropTableSQL(a);return execute(d[0],d[1],b,c)},insert:function(a,b,c,d){var e=insertSQL(a,b);return execute(e[0],e[1],c,d)},replace:function(a,b,c,d){var e=replaceSQL(a,b);return execute(e[0],e[1],c,d)},update:function(a,b,c,d,e){var f=updateSQL(a,b,c);return execute(f[0],f[1],d,e)},select:function(a,b,c,d,e,f){var g=selectSQL(a,b,c,d);return execute(g[0],g[1],e,f)},destroy:function(a,b,c,d){var e=destroySQL(a,b);return execute(e[0],e[1],c,d)},close:function(){sqlite.close()}}}}