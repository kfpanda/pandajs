/*! protocol - v2.0.1 - 2015-07-13 */IMClientProtocol=function(){var a={},b={},c=external.createObject("InstantMessager");b.InstantMessager=c;var d=function(a,b){},e=function(a,b){logger.log("IMClient请求("+a+"),返回结果："+b);var c={};try{c=$.xml2json(b)}catch(d){logger.error(["IMClient请求("+a+"), $.xml2json(xmlData) 解析出错：",d])}if(c.result)return void f(c);for(o in c)if("string"!=typeof c[o]){var e={};if($.isArray(c[o]))for(var g=0;g<c[o].length;g++)e[o]=c[o][g],e.op=o,f(e);else e[o]=c[o],e.op=o,f(e)}},f=function(b){var c="success",e="",f={};try{e=(b.result||{}).id,f=a[e]?a[e]:a["op_"+b.op]?a["op_"+b.op]:{},$.isFunction(f.resultWrapper)&&(b=f.resultWrapper(b)),b.status="success"}catch(g){b=g,b.status="error",c="error"}"success"===c?($.isFunction(f.afterSuccess)&&f.afterSuccess(f,b,c),$.isFunction(f.success)&&f.success.call(f.scope,f,b,c)):(c="error",d(b,c)),$.isFunction(f.complete)&&f.complete.call(f.scope,f,c),a[e]=void 0};c.registerEvent(e);var g=function(c){var d=b[c.external];d||(d=external.createObject(c.external),b[c.external]=d);var e=null;return(c.parameter||{}).id?(c.parameter.id="function"==typeof c.parameter.id?c.parameter.id():c.parameter.id,a[c.parameter.id]=c,e=d[c.url](c.parameter),logger.log(["调用url："+c.url+"， 请求参数：",c.parameter])):((c.parameter||{}).id=void 0,c.parameter?((c.parameter||{}).id=void 0,e=d[c.url](c.parameter)):e=d[c.url](),logger.log(["调用url："+c.url+"， 请求参数：",c.parameter," 直接结果返回：",e])),e},h=function(a){var b={};return $.isEmptyObject(a)?b:($.isEmptyObject(a.result)||($.each(a.result,function(a,c){b[a]=c}),a.result=void 0),b.op=a.op,b.data=a[b.op],b)},i=function(a){},j=function(a){var b={};return b.external=a.external,b.failure=a.failure,b.complete=a.complete,b.resultWrapper=a.resultWrapper,b.dataType=a.dataType,b.scope=a.scope,$.isFunction(b.resultWrapper)||(b.resultWrapper=h),b},k=function(b){a["op_"+b.parameter.op]=b};Protocol.registerRequest("IMClient",{type:"IMClient",getOptions:j,validateOptions:i,request:g,registerEvent:k})}();