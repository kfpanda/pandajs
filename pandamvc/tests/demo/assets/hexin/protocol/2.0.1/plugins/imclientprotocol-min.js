/*! protocol - v2.0.1 - 2014-03-11 */IMClientProtocol=function(){var e={},t={},r=external.createObject("InstantMessager");t.InstantMessager=r;var a=function(){},s=function(e,t){logger.log("IMClient请求("+e+"),返回结果："+t);var r={};try{r=$.xml2json(t)}catch(a){logger.error(["IMClient请求("+e+"), $.xml2json(xmlData) 解析出错：",a])}if(r.result)return n(r),void 0;for(o in r)if("string"!=typeof r[o]){var s={};if($.isArray(r[o]))for(var c=0;r[o].length>c;c++)s[o]=r[o][c],s.op=o,n(s);else s[o]=r[o],s.op=o,n(s)}},n=function(t){var r="success",s="",o={};try{s=(t.result||{}).id,o=e[s]?e[s]:e["op_"+t.op]?e["op_"+t.op]:{},$.isFunction(o.resultWrapper)&&(t=o.resultWrapper(t)),t.status="success"}catch(n){t=n,t.status="error",r="error"}"success"===r?($.isFunction(o.afterSuccess)&&o.afterSuccess(o,t,r),$.isFunction(o.success)&&o.success.call(o.scope,o,t,r)):(r="error",a(t,r)),$.isFunction(o.complete)&&o.complete.call(o.scope,o,r),e[s]=void 0};r.registerEvent(s);var c=function(r){var a=t[r.external];a||(a=external.createObject(r.external),t[r.external]=a);var s=null;return(r.parameter||{}).id?(r.parameter.id="function"==typeof r.parameter.id?r.parameter.id():r.parameter.id,e[r.parameter.id]=r,s=a[r.url](r.parameter),logger.log(["调用url："+r.url+"， 请求参数：",r.parameter])):((r.parameter||{}).id=void 0,r.parameter?((r.parameter||{}).id=void 0,s=a[r.url](r.parameter)):s=a[r.url](),logger.log(["调用url："+r.url+"， 请求参数：",r.parameter," 直接结果返回：",s])),s},l=function(e){var t={};return $.isEmptyObject(e)?t:($.isEmptyObject(e.result)||($.each(e.result,function(e,r){t[e]=r}),e.result=void 0),t.op=e.op,t.data=e[t.op],t)},p=function(){},i=function(e){var t={};return t.external=e.external,t.failure=e.failure,t.complete=e.complete,t.resultWrapper=e.resultWrapper,t.dataType=e.dataType,t.scope=e.scope,$.isFunction(t.resultWrapper)||(t.resultWrapper=l),t},u=function(t){e["op_"+t.parameter.op]=t};Protocol.registerRequest("IMClient",{type:"IMClient",getOptions:i,validateOptions:p,request:c,registerEvent:u})}();