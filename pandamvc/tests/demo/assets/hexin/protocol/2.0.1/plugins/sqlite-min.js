/*! protocol - v2.0.1 - 2014-03-11 */function SQLite(cfg){function isNumber(e){switch(typeof e){case"number":return!0;case"string":return!1;case"object":return!1}}function nullDataHandler(){}function errorHandler(e){logger.error("Oops. "+e.message+" (Code "+e.code+")")}function execute(query,values,dataHandler){if(!query)return null;query=query.split("?");for(var newQuery=query[0],index=0,idx=0;values.length>idx;idx++){var value=values[idx]||"";!isNumber(value)&&0>value.indexOf("desc")&&value.indexOf("asc")&&(value=(value||"").replace(/\'/g,"''").replace(/\"/g,'\\"'),value="'"+value+"'"),newQuery+=value,newQuery+=query.length>index+1?query[index+1]:"",index++}var dHandler=function(rownum,data){try{data=eval("("+data+")")}catch(e){}dataHandler(rownum,data)};return logger.log("SQLITE执行sql语句:"+newQuery),sqlite.execSql(newQuery,dHandler)}function buildConditions(e){var r,t=[],a=[];if("string"==typeof e)t.push(e);else if("number"==typeof e)t.push("id=?"),a.push(e);else if("object"==typeof e)for(r in e)e.hasOwnProperty(r)&&(isNumber(r)?t.push(e[r]):(t.push(r+"=?"),a.push(e[r])));return t=t.length>0?" WHERE "+t.join(" AND "):"",[t,a]}function createIndexSQL(e,r,t){var a="CREATE INDEX IF NOT EXISTS "+e+" ON "+r+"("+t+");";return[a,[]]}function createTableSQL(e,r){var t="CREATE TABLE IF NOT EXISTS "+e+"("+r+");";return[t,[]]}function dropTableSQL(e){var r="DROP TABLE "+e+";";return[r,[]]}function insertSQL(e,r){var t,a="INSERT INTO "+e+" (#k#) VALUES(#v#);",n=[],o=[],c=[];for(t in r)r.hasOwnProperty(t)&&(n.push(t),o.push("?"),c.push(r[t]));return a=a.replace("#k#",n.join(",")),a=a.replace("#v#",o.join(",")),[a,c]}function replaceSQL(e,r){var t,a="REPLACE INTO "+e+" (#k#) VALUES(#v#);",n=[],o=[],c=[];for(t in r)r.hasOwnProperty(t)&&(n.push(t),o.push("?"),c.push(r[t]));return a=a.replace("#k#",n.join(",")),a=a.replace("#v#",o.join(",")),[a,c]}function updateSQL(e,r,t){var a,n="UPDATE "+e+" SET #k##m#",o=[],c=[];for(a in r)r.hasOwnProperty(a)&&(o.push(a+"=?"),c.push(r[a]));return t=buildConditions(t),c=c.concat(t[1]),n=n.replace("#k#",o.join(",")),n=n.replace("#m#",t[0]),[n,c]}function selectSQL(e,r,t,a){var n="SELECT #col# FROM "+e+"#cond#",o=[];return r===void 0?r="*":"object"==typeof r&&r.join(","),t=buildConditions(t),o=o.concat(t[1]),n=n.replace("#col#",r),n=n.replace("#cond#",t[0]),a&&(a.order&&(n+=" ORDER BY ?",o.push(a.order)),a.limit&&(n+=" LIMIT ?",o.push(a.limit)),a.offset&&(n+=" OFFSET ?",o.push(a.offset))),n+=";",[n,o]}function destroySQL(e,r){var t="DELETE FROM "+e+"#c#;";return r=buildConditions(r),t=t.replace("#c#",r[0]),[t,r[1]]}var sqlite=external.createObject("Sqlite");if(null!=sqlite){var config=cfg||{},db;config.shortName=config.shortName||"mydatabase",config.version=config.version||"1.0",config.displayName=config.displayName||"My SQLite Database",config.maxSize=65536,config.defaultErrorHandler=config.defaultErrorHandler||errorHandler,config.defaultDataHandler=config.defaultDataHandler||nullDataHandler;var result=sqlite.createDataBase(config.path);return"-2"==result?(logger.error("打开数据库失败，参数错误。"),void 0):"-3"==result?(logger.error("打开数据库失败."),void 0):{database:sqlite,createIndex:function(e,r,t,a,n){var o=createIndexSQL(e,r,t);return execute(o[0],o[1],a,n)},createTable:function(e,r,t,a){var n=createTableSQL(e,r);return execute(n[0],n[1],t,a)},dropTable:function(e,r,t){var a=dropTableSQL(e);return execute(a[0],a[1],r,t)},insert:function(e,r,t,a){var n=insertSQL(e,r);return execute(n[0],n[1],t,a)},replace:function(e,r,t,a){var n=replaceSQL(e,r);return execute(n[0],n[1],t,a)},update:function(e,r,t,a,n){var o=updateSQL(e,r,t);return execute(o[0],o[1],a,n)},select:function(e,r,t,a,n,o){var c=selectSQL(e,r,t,a);return execute(c[0],c[1],n,o)},destroy:function(e,r,t,a){var n=destroySQL(e,r);return execute(n[0],n[1],t,a)},close:function(){sqlite.close()}}}}